{% extends "layouts/base.html" %}
{% block title %}Configuración Grupos{% endblock %}

{% block content %}
<h1>Configuración de Grupos</h1>
<p>Bienvenido, {{ usuario }}. Aquí puedes gestionar los grupos.</p>

<div class="card card-body border-0 shadow mb-4">


    <button class="btn btn-primary mb-3" onclick="abrirModal()">
        ➕ Crear nuevo grupo
    </button>

    <div class=" border-0 shadow table-wrapper table-responsive">
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Grupo</th>
                    <th>Variante</th>
                    <th>Tipo</th>
                    <th>Abreviación</th>
                </tr>
            </thead>
            <tbody>
                {% for g in grupos %}
                <tr>
                    <td>{{ g[1] }}</td>
                    <td>{{ g[2] }}</td>
                    <td>{{ g[3] or '' }}</td>
                    <td>{{ g[4] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div id="modalGrupo" class="modal card card-body border-0 shadow mb-4" style="display:none;">
        <div class="modal-content">
            <h4>Nuevo Grupo</h4>

            <input type="text" id="grupo" placeholder="Grupo">
            <input type="text" id="variante" placeholder="Variante">
            <input type="text" id="tipo" placeholder="Tipo (opcional)">
            <input type="text" id="abreviacion" placeholder="Abreviación">

            <div class="mt-3">
                <button class="btn btn-success" onclick="guardarGrupo()">Guardar</button>
                <button class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL -->


<script>
function abrirModal() {
    document.getElementById('modalGrupo').style.display = 'block';
}

function cerrarModal() {
    document.getElementById('modalGrupo').style.display = 'none';
}

function guardarGrupo() {
    const data = {
        grupo: document.getElementById('grupo').value.trim(),
        variante: document.getElementById('variante').value.trim(),
        tipo: document.getElementById('tipo').value.trim(),
        abreviacion: document.getElementById('abreviacion').value.trim()
    };

    fetch('/grupos/crear', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    })
    .then(res => {
        if (!res.ok) throw new Error();
        return res.json();
    })
    .then(() => location.reload())
    .catch(() => alert('Error al guardar grupo'));
}
</script>


{% endblock %}
